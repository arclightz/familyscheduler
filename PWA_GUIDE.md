# PWA Implementation Guide

This document describes the Progressive Web App (PWA) implementation for Family Task Scheduler.

## Overview

The app is now a fully functional PWA that can be installed on devices and works offline.

## Features

### ✅ Implemented

1. **Web App Manifest** (`public/manifest.json`)
   - App name, description, and branding
   - Multiple icon sizes (72px to 512px)
   - Standalone display mode
   - Launch shortcuts to Planner and Tasks
   - Theme color: `#2563eb` (blue)

2. **Service Worker** (auto-generated by next-pwa)
   - Offline caching for static assets
   - Network-first strategy for API calls
   - Stale-while-revalidate for images and fonts
   - 5-minute cache for API responses
   - 1-day cache for static assets

3. **Install Prompt** (`src/components/pwa/InstallPrompt.tsx`)
   - Automatically appears when browser supports installation
   - "Not now" option with session memory
   - Can be dismissed per session

4. **Apple iOS Support**
   - Apple Web App capable meta tags
   - Custom status bar styling
   - App title configuration

## Installation

### Desktop (Chrome, Edge, Brave)

1. Visit the app in a supported browser
2. Look for the install icon in the address bar
3. Or use the install prompt at the bottom of the page
4. Click "Install" and confirm

### Mobile (Android)

1. Open the app in Chrome
2. Tap the menu (⋮) → "Add to Home Screen"
3. Or use the install prompt that appears automatically
4. Confirm installation

### Mobile (iOS - Safari)

1. Open the app in Safari
2. Tap the Share button
3. Scroll down and tap "Add to Home Screen"
4. Confirm installation

## Offline Functionality

The app caches the following resources for offline use:

- **Static Assets**: JS, CSS, fonts, images (24-hour cache)
- **API Responses**: GET requests (5-minute cache)
- **Pages**: All visited pages (network-first with fallback)
- **Google Fonts**: 1-year cache

### Testing Offline Mode

1. Install the app
2. Open DevTools (F12)
3. Go to Network tab
4. Check "Offline" checkbox
5. Navigate the app - cached pages will still load

## Configuration

### PWA Settings

Edit `next.config.mjs` to customize:

```javascript
withPWA({
  dest: 'public',              // Service worker output
  register: true,              // Auto-register SW
  skipWaiting: true,           // Activate new SW immediately
  disable: process.env.NODE_ENV === 'development',
  runtimeCaching: [...]        // Caching strategies
})
```

### Manifest Settings

Edit `public/manifest.json` to customize:

- App name and description
- Theme and background colors
- Icon paths
- Display mode
- Shortcuts

### Caching Strategies

**CacheFirst** - Serve from cache, fall back to network
- Google Fonts (1 year)

**StaleWhileRevalidate** - Serve from cache, update in background
- Static assets (1 day)
- Images (1 day)
- Fonts (1 week)

**NetworkFirst** - Try network, fall back to cache
- API calls (5 minutes)
- Pages (1 day)

## Icons

### Current Icons

SVG-based placeholder icons are located in `public/icons/`.

### Replacing Icons

For production, replace with actual PNG icons:

1. Create a 512x512 source image
2. Use an icon generator:
   - https://realfavicongenerator.net/
   - https://www.pwabuilder.com/imageGenerator
3. Generate all sizes: 72, 96, 128, 144, 152, 192, 384, 512
4. Place in `public/icons/`
5. Update `public/manifest.json` to use `.png` instead of `.svg`

Or use ImageMagick:

```bash
for size in 72 96 128 144 152 192 384 512; do
  convert source.png -resize ${size}x${size} public/icons/icon-${size}x${size}.png
done
```

## Development

### Disabling PWA in Development

PWA is automatically disabled in development mode to avoid caching issues.

To enable for testing:

```javascript
// next.config.mjs
withPWA({
  disable: false,  // Enable in dev
  // ...
})
```

### Clearing Cache

If you need to clear the service worker cache:

1. Open DevTools (F12)
2. Go to Application tab
3. Click "Service Workers"
4. Click "Unregister"
5. Go to "Storage" → "Clear site data"
6. Reload the page

### Debugging

**Service Worker**
- DevTools → Application → Service Workers
- Check registration status
- View cache storage

**Manifest**
- DevTools → Application → Manifest
- Verify icon paths
- Check installability

**Network**
- DevTools → Network
- Filter by service worker requests
- Check cache hits (from ServiceWorker)

## Production Checklist

Before deploying to production:

- [ ] Replace placeholder icons with designed icons
- [ ] Test on multiple devices (Android, iOS, Desktop)
- [ ] Verify offline functionality
- [ ] Test install prompt
- [ ] Update app name/description if needed
- [ ] Configure proper cache durations
- [ ] Test uninstall/reinstall flow
- [ ] Verify HTTPS (required for PWA)

## Resources

- [PWA Documentation](https://web.dev/progressive-web-apps/)
- [next-pwa Documentation](https://github.com/shadowwalker/next-pwa)
- [Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [Workbox](https://developers.google.com/web/tools/workbox)

## Troubleshooting

**Install button doesn't appear**
- Check HTTPS is enabled
- Verify manifest.json is accessible
- Ensure icons are valid
- Check console for errors

**Offline mode not working**
- Verify service worker is registered
- Check cache storage in DevTools
- Ensure caching strategy is configured

**Updates not appearing**
- Service worker is caching old version
- Force refresh (Ctrl+Shift+R)
- Unregister SW and reload

**iOS installation issues**
- iOS only supports installation via Safari
- Check Apple Web App meta tags
- Verify icon sizes (minimum 152x152)
